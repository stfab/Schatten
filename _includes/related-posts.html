<div class="related">
  <h2>Related Posts</h2>
  {% assign related_posts = site.posts | where:"categories", page.categories %}
  {% if related_posts.size == 0 %}
    {% assign related_posts = site.posts | where:"tags", page.tags %}
  {% endif %}
  {% if related_posts.size == 0 %}
    {% assign related_posts = site.posts | sort: 'date' | reverse | limit: 3 %}
  {% endif %}
  {% for post in related_posts limit:3 %}
  <article class="post-preview">
    <div class="post-preview-meta">
      <h2>
        <a href="{{ site.github.url }}{{ post.url }}">
          {{ post.title }}
        </a>
      </h2>
      <p class="post-date">
        {{ post.date | date: "%B %-d, %Y" }} | {{ post.author }} | {{ post.content | number_of_words | divided_by: 200 | append: " min" }}
      </p>
      <p>
        {{ post.excerpt | strip_html | truncatewords: 35 }}
      </p>
    </div>
    <div class="post-image-preview">
      {% if post.image %}
        <a href="{{ site.github.url }}{{ post.url }}"><img src="{{ post.image }}" alt="{{ post.title }}"></a>
      {% endif %}
    </div>
  </article>
  {% endfor %}
</div>